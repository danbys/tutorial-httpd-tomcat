# HTTPd and Tomcat

## Why bother?
**Apache Tomcat already have a built in web server, why bother install Apache HTTPd?** Tomcat bundles a generic web server to make your first .war deployemnt fast and easy. HTTPd adds functionality and performance.

* Tomcat is a application server serving .jsp files
* HTTPd is a pure web server providing additional functionality like nicer looking urls, load balancing, performance advantages, ssl and more.

**Is the additional functionality worth the extra mile?** Mabye not. Yet, some day this extra mile is worth the effort.

## Let's get started

This tutorial describes how to install HTTPd on Windows 7 and forward .jsp requests to Tomcat allowing you to make use of the best of two worlds.

It is assumend that Tomcat 6.0 64-bit is installed in default `C:\Program Files\Apache Software Foundation\Tomcat 6.0` directory. A differnet operating system or Tomcat version may be used if some of the file paths or distributed software are replaced in the instructions below.

Download tutorial files to `C:\tutorial-httpd-tomcat` using Git
```sh
$ git clone https://github.com/danbys/tutorial-httpd-tomcat.git /c/tutorial-httpd-tomcat
Cloning into 'c:/tutorial-httpd-tomcat'...
remote: Counting objects: 28, done.
remote: Compressing objects: 100% (21/21), done.
remote: Total 28 (delta 1), reused 24 (delta 1)
Unpacking objects: 100% (28/28), done.
```

Aternatively download https://github.com/danbys/tutorial-httpd-tomcat/archive/master.zip and uncompress .zip to `C:\tutorial-httpd-tomcat`

Uncompress distributed software
```bat
C:\tutorial-httpd-tomcat>scripts\uncompess.bat
Uncompressing:
httpd-2.4.7-win64
mod_jk-1.2.37-win64
```


### HTTPd default installtion

Move HTTPd to install directory
```bat
C:\tutorial-httpd-tomcat>move downloads\httpd-2.4.7-win64\Apache24 \
     1 dir(s) moved.
```

Install HTTPd as a windows service
```bat
C:\tutorial-httpd-tomcat>\Apache24\bin\httpd.exe -k install
Installing the Apache2.4 service
The Apache2.4 service is successfully installed.
Testing httpd.conf....
Errors reported here must be corrected before the service can be started.
```

Start HTTPd service

![Windows services](images/start_apache_service.png)

Check if HTTPd is running

![Test if HTTPd is running](images/it_works.png)

Yeaay, our web server is live! What happend here? Default HTTPd configuration serves static files in `C:\Apache24\htdocs`

### Tomcat connector module

Lets have HTTPd serve .jsp requests

Verify your Tomcat site is up running

![Tomcat is up running](images/tomcat_running.png)

### Enable Tomcat mod_jk

Add Tomcat connector module
```bat
C:\tutorial-httpd-tomcat>move downloads\mod_jk-1.2.37-win64\mod_jk.so Apache24\modules
     1 file(s) moved.
```

Create `%TOMCAT_HOME%\conf\jk\workers.properties`
```apache
# C:\Program Files\Apache Software Foundation\Tomcat 6.0\conf\jk\workers.properties

# Define 1 real worker using ajp13
worker.list=ajp13
# Set properties for worker1 (ajp13)
worker.worker1.type=ajp13
worker.worker1.host=localhost
worker.worker1.port=8009
```

Restart Tomcat, wait 2 minutes, `%TOMCAT_HOME%\conf\auto\mod_jk.conf` is generated by Tomcat.

### Enable HTTPd mod_jk

Add the following lines to `%HTTPD_HOME%\conf\httpd.conf`
```apache
# C:\Apache24\conf\httpd.conf

Include "C:\Program Files\Apache Software Foundation\Tomcat 6.0\conf\auto\mod_jk.conf"
```

Restart HTTPd
